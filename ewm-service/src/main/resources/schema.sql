DROP TABLE IF EXISTS comments, list_compilations, compilations, requests, events,categories, locations, users;

CREATE TABLE IF NOT EXISTS users (
    id INTEGER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    name VARCHAR(255) NOT NULL,
    email VARCHAR(512) NOT NULL,
    CONSTRAINT UQ_USER_EMAIL UNIQUE (email)
);

CREATE TABLE IF NOT EXISTS locations (
    id INTEGER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    lat FLOAT NOT NULL,
    lon FLOAT NOT NULL
);

CREATE TABLE IF NOT EXISTS categories (
    id INTEGER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    name VARCHAR(255) NOT NULL,
    CONSTRAINT UQ_CATEGORY_NAME UNIQUE (name)
);

CREATE TABLE IF NOT EXISTS events (
    id INTEGER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    annotation VARCHAR(2000) NOT NULL,
    category_id INTEGER NOT NULL REFERENCES categories (id),
    confirmed_requests INTEGER,
    created TIMESTAMP WITHOUT TIME ZONE NOT NULL,
    description VARCHAR(7000) NOT NULL,
    event_date TIMESTAMP WITHOUT TIME ZONE NOT NULL ,
    initiator_id INTEGER NOT NULL REFERENCES users (id),
    location_id INTEGER NOT NULL REFERENCES locations (id),
    paid BOOLEAN NOT NULL,
    participant_limit INTEGER NOT NULL,
    published TIMESTAMP WITHOUT TIME ZONE,
    request_moderation BOOLEAN NOT NULL,
    state VARCHAR(55) NOT NULL,
    title VARCHAR(120) NOT NULL,
    views INTEGER
);

CREATE TABLE IF NOT EXISTS requests (
    id INTEGER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    created TIMESTAMP WITHOUT TIME ZONE NOT NULL,
    event INTEGER NOT NULL REFERENCES events (id),
    requester INTEGER NOT NULL REFERENCES users (id),
    status VARCHAR(55) NOT NULL
);

CREATE TABLE IF NOT EXISTS compilations (
    id INTEGER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    pinned BOOLEAN NOT NULL,
    title VARCHAR(120) NOT NULL
);

CREATE TABLE IF NOT EXISTS list_compilations (
    id INTEGER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    compilation_id INTEGER NOT NULL REFERENCES compilations (id),
    event_id INTEGER NOT NULL REFERENCES events (id)
);

CREATE TABLE IF NOT EXISTS comments (
    id INTEGER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    text VARCHAR(1000) NOT NULL,
    event_id INTEGER NOT NULL REFERENCES events (id),
    author_id INTEGER NOT NULL REFERENCES users (id),
    created  TIMESTAMP WITHOUT TIME ZONE
);
